applications:
  - name: btp-ktor-postgres
    memory: 768M
    instances: 1
    path: build/libs/btp-ktor-postgres-all.jar
    random-route: true
    buildpacks:
      - sap_java_buildpack_jakarta

    # Cloud Foundry uses the Java buildpack automatically if it detects a JVM app
    env:
      # Optional: lets you switch which bound postgres instance to pick from VCAP
      DB_SERVICE_NAME: postgreSQL-dev

      # Optional: SSL mode for JDBC. If verify-full fails, switch to require.
      PG_SSLMODE: verify-full

      # Hikari pool tuning (optional)
      DB_POOL_MAX: "10"
      DB_POOL_MIN: "2"
      JBP_CONFIG_COMPONENTS: '{jres: ["com.sap.xs.java.buildpack.jre.SAPMachineJRE"]}'
      JBP_CONFIG_SAP_MACHINE_JRE: '{use_offline_repository: false, version: 21.+}'

      # JVM memory tuning (safe defaults on CF)
      JAVA_OPTS: >
        -XX:MaxRAMPercentage=75
        -Dfile.encoding=UTF-8

    services:
      - postgreSQL-dev
      - xsuaa-postgres
